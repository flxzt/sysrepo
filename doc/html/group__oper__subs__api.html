<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sysrepo: Operational Data Subscription API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cesnet-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">sysrepo<span id="projectnumber">&#160;2.2.117</span>
   </div>
   <div id="projectbrief">YANG-based system repository for all-around configuration management.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__oper__subs__api.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Operational Data Subscription API</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga65358bd98a1cd6c46f2f8761dce983b5" id="r_ga65358bd98a1cd6c46f2f8761dce983b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga65358bd98a1cd6c46f2f8761dce983b5">sr_oper_get_subscribe</a> (<a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *session, const char *module_name, const char *path, <a class="el" href="#ga323d3b6be692e271e49cf8af048023aa">sr_oper_get_items_cb</a> callback, void *private_data, <a class="el" href="group__subs__api.html#gaaa041e80af5ead759b0ba710e116d145">sr_subscr_options_t</a> opts, <a class="el" href="group__subs__api.html#gab9382eb7f93c3610b9b701d46c61a166">sr_subscription_ctx_t</a> **subscription)</td></tr>
<tr class="memdesc:ga65358bd98a1cd6c46f2f8761dce983b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register for providing operational data at the given path.  <br /></td></tr>
<tr class="separator:ga65358bd98a1cd6c46f2f8761dce983b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga304b3604048debd297a1f1564427ada3" id="r_ga304b3604048debd297a1f1564427ada3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga304b3604048debd297a1f1564427ada3">sr_oper_poll_subscribe</a> (<a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *session, const char *module_name, const char *path, uint32_t valid_ms, <a class="el" href="group__subs__api.html#gaaa041e80af5ead759b0ba710e116d145">sr_subscr_options_t</a> opts, <a class="el" href="group__subs__api.html#gab9382eb7f93c3610b9b701d46c61a166">sr_subscription_ctx_t</a> **subscription)</td></tr>
<tr class="memdesc:ga304b3604048debd297a1f1564427ada3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start periodic retrieval and caching of operational data at the given path.  <br /></td></tr>
<tr class="separator:ga304b3604048debd297a1f1564427ada3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga323d3b6be692e271e49cf8af048023aa" id="r_ga323d3b6be692e271e49cf8af048023aa"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga323d3b6be692e271e49cf8af048023aa">sr_oper_get_items_cb</a>) (<a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *session, uint32_t sub_id, const char *module_name, const char *path, const char *request_xpath, uint32_t request_id, struct lyd_node **parent, void *private_data)</td></tr>
<tr class="memdesc:ga323d3b6be692e271e49cf8af048023aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to be called when operational data at the selected xpath are requested. Data are represented as <em>libyang</em> subtrees.  <br /></td></tr>
<tr class="separator:ga323d3b6be692e271e49cf8af048023aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga323d3b6be692e271e49cf8af048023aa" name="ga323d3b6be692e271e49cf8af048023aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga323d3b6be692e271e49cf8af048023aa">&#9670;&#160;</a></span>sr_oper_get_items_cb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* sr_oper_get_items_cb) (<a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *session, uint32_t sub_id, const char *module_name, const char *path, const char *request_xpath, uint32_t request_id, struct lyd_node **parent, void *private_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to be called when operational data at the selected xpath are requested. Data are represented as <em>libyang</em> subtrees. </p>
<p>When the callback is called, the data parent is provided. Any parent children (selected by <code>path</code>) are removed and should be provided by the callback instead, if they exist. Callback handler can provide any data matching the <code>path</code> but in case there are other nested subscriptions, they will be called after this one (and when they are called, their parent children will again be removed which can result in nodes provided by the original callback being lost).</p>
<dl class="section note"><dt>Note</dt><dd>Callback must not modify the same module operational subscriptions, it would result in a deadlock.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>Implicit session (do not stop) with information about the event originator session IDs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sub_id</td><td>Subscription ID. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">module_name</td><td>Name of the affected module. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td><a class="el" href="index.html#paths">Path</a> identifying the subtree that is supposed to be provided, same as the one used for the subscription. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_xpath</td><td><a class="el" href="index.html#paths">XPath</a> as requested by a client. Can be NULL. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_id</td><td>Request ID unique for the specific <code>module_name</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">parent</td><td>Pointer to an existing parent of the requested nodes. Is NULL for top-level nodes. Caller is supposed to append the requested nodes to this data subtree and return either the original parent or a top-level node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">private_data</td><td>Private context opaque to sysrepo, as passed to <a class="el" href="#ga65358bd98a1cd6c46f2f8761dce983b5" title="Register for providing operational data at the given path.">sr_oper_get_subscribe</a> call. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>User error code (<a class="el" href="group__log__api.html#gga3541b16be4e12bd061b7e24d4be29c30a9349114b18324f7d763650d2cd577df3">SR_ERR_OK</a> on success). </dd></dl>

<p class="definition">Definition at line <a class="el" href="sysrepo__types_8h_source.html#l00669">669</a> of file <a class="el" href="sysrepo__types_8h_source.html">sysrepo_types.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga65358bd98a1cd6c46f2f8761dce983b5" name="ga65358bd98a1cd6c46f2f8761dce983b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga65358bd98a1cd6c46f2f8761dce983b5">&#9670;&#160;</a></span>sr_oper_get_subscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sr_oper_get_subscribe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *</td>          <td class="paramname"><span class="paramname"><em>session</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>module_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#ga323d3b6be692e271e49cf8af048023aa">sr_oper_get_items_cb</a></td>          <td class="paramname"><span class="paramname"><em>callback</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>private_data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__subs__api.html#gaaa041e80af5ead759b0ba710e116d145">sr_subscr_options_t</a></td>          <td class="paramname"><span class="paramname"><em>opts</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__subs__api.html#gab9382eb7f93c3610b9b701d46c61a166">sr_subscription_ctx_t</a> **</td>          <td class="paramname"><span class="paramname"><em>subscription</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register for providing operational data at the given path. </p>
<p>Usual behaviour is only ONE subscription for ONE XPath. When subscribing to the same XPath that was used in some previous subscription, <a class="el" href="group__subs__api.html#ggaa629478596b1e246553eac91a74b2b5bad8c77539582e1de78f57e256299ea138" title="Instead of removing any previous existing matching data before getting them from an operational subsc...">SR_SUBSCR_OPER_MERGE</a> flag has to be used. Every subscription has its internal priority based on the order in which they were subscribed. Priority influences merging the operational data from multiple subscriptions with the same XPath. Operational data returned by later subscriptions overwrite the same data from any previous subscriptions. When retrieving data all subscription callbacks with the same XPath are called simultaneously (to achieve this, <code>subscription</code> should be different for each subscription so that there are separate threads listening for each of the events).</p>
<p>Required WRITE access.</p>
<dl class="section note"><dt>Note</dt><dd>Be aware of some specific <a class="el" href="subs.html#oper_subs">threading limitations</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>Session (not <a class="el" href="sysrepo__types_8h.html#ad62b76ff858c1a2af6af2098153597e6">DS</a>-specific) to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">module_name</td><td>Name of the affected module. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td><a class="el" href="index.html#paths">Path</a> identifying the subtree (not strictly required, all list/leaf-list instances are also valid, for example) which the provider is able to provide. Predicates can be used to provide only specific instances of nodes. Before calling this callback, any existing data matching this path <b>are deleted</b> (unless modified by <code>opts</code>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callback</td><td>Callback to be called when the operational data for the given xpath are requested. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">private_data</td><td>Private context passed to the callback function, opaque to sysrepo. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">opts</td><td>Options overriding default behavior of the subscription, it is supposed to be a bitwise OR-ed value of any <a class="el" href="group__subs__api.html#gaa629478596b1e246553eac91a74b2b5b" title="Flags used to override default handling of subscriptions.">sr_subscr_flag_t</a> flags. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">subscription</td><td>Subscription context, zeroed for first subscription, freed by <a class="el" href="group__subs__api.html#ga8fe49b0cf74d5744cae2aa47d13d480b" title="Unsubscribe all the subscriptions in a subscription structure and free it.">sr_unsubscribe</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (<a class="el" href="group__log__api.html#gga3541b16be4e12bd061b7e24d4be29c30a9349114b18324f7d763650d2cd577df3">SR_ERR_OK</a> on success). </dd></dl>

</div>
</div>
<a id="ga304b3604048debd297a1f1564427ada3" name="ga304b3604048debd297a1f1564427ada3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga304b3604048debd297a1f1564427ada3">&#9670;&#160;</a></span>sr_oper_poll_subscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sr_oper_poll_subscribe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sysrepo__types_8h.html#a0de3599f66e9100f930f60a0ab00c60c">sr_session_ctx_t</a> *</td>          <td class="paramname"><span class="paramname"><em>session</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>module_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>valid_ms</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__subs__api.html#gaaa041e80af5ead759b0ba710e116d145">sr_subscr_options_t</a></td>          <td class="paramname"><span class="paramname"><em>opts</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__subs__api.html#gab9382eb7f93c3610b9b701d46c61a166">sr_subscription_ctx_t</a> **</td>          <td class="paramname"><span class="paramname"><em>subscription</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start periodic retrieval and caching of operational data at the given path. </p>
<p>The operational data are cached in the connection of <code>session</code>. When any session created on this connection requires data of the cached operational get subscription at <code>path</code>, the callback is not called and the cached data are used instead. Additionally, if <code>opts</code> include <a class="el" href="group__subs__api.html#ggaa629478596b1e246553eac91a74b2b5ba9c0c563932e1cef41ebb8152ea909069" title="On every data retrieval additionally compute diff with the previous data and report the changes to an...">SR_SUBSCR_OPER_POLL_DIFF</a>, any changes detected on cache data refresh are reported to corresponding subscribers. For an operational get subscription, there can only be a <b>single</b> operational poll subscription with this flag. The first cache update is performed directly by this function.</p>
<p>Required READ access.</p>
<dl class="section note"><dt>Note</dt><dd>Be aware of some specific <a class="el" href="subs.html#oper_subs">threading limitations</a>. Especially note that you cannot have an operational poll subscription in the same <code>subscription</code> structure as the operational get subscription being cached because a dead-lock would occur on cache update.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>Session (not <a class="el" href="sysrepo__types_8h.html#ad62b76ff858c1a2af6af2098153597e6">DS</a>-specific) to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">module_name</td><td>Name of the affected module. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">path</td><td><a class="el" href="index.html#paths">Path</a> matching the operational get subscription(s) to poll. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">valid_ms</td><td>Time the retrieved data are stored in cache until being considered invalid. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">opts</td><td>Options overriding default behavior of the subscription, it is supposed to be a bitwise OR-ed value of any <a class="el" href="group__subs__api.html#gaa629478596b1e246553eac91a74b2b5b" title="Flags used to override default handling of subscriptions.">sr_subscr_flag_t</a> flags. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">subscription</td><td>Subscription context, zeroed for first subscription, freed by <a class="el" href="group__subs__api.html#ga8fe49b0cf74d5744cae2aa47d13d480b" title="Unsubscribe all the subscriptions in a subscription structure and free it.">sr_unsubscribe</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (<a class="el" href="group__log__api.html#gga3541b16be4e12bd061b7e24d4be29c30a9349114b18324f7d763650d2cd577df3">SR_ERR_OK</a> on success). </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jan 28 2025 10:56:44 for sysrepo by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
